---
title: RAC历史及简介
date: 2019-10-17 
categories: Oracle
tags: Oracle-RAC
---



### RAC发展历史   

1983年 DEC公司的VAX--cluster出现了集群的概念  
因为在那个时间年代disk（磁盘）、printer（打印机）的价格非常昂贵
所以出现了一种机制，即：多台机器共同操作一个磁盘组，以解决硬盘昂贵问题，  
多台机器共享一个磁盘柜，磁盘柜可以是数据库也可以是其他产品。

最初仅是将多个无盘工作站链接起来到一个磁盘柜上工作已解决昂贵的成本问题，慢慢的发现成了一个容错的概念，现在的集群还提供负载均衡功能。

Oracle在7版本的集群是由原厂商提供；  
8版本的时候Oracle真正推出了RAC，早起的集群名为OPS(有缓存协调)，又有一些缺陷被Oracle淘汰；  
9i的时候推出了RAC（缓存融合）。



### RAC集群的优势：   

#### 一、High Available高可用性  

1. 节点容错：集群中每个节点都有单独的内存、CPU、I/O，任何一个节点坏了其他节点可支持持续工作。   
2. 负载均衡：负载均衡主要指集群把来自客户端的负载平均分配到据群众的各节点，成倍提高系统的吞吐量。

-    RAC的负载均衡主要体现在两个方面:   
  - 客户端的负载均衡：（注：客户端的负载均衡不是真正意义上的负载均衡）

    - 在tnsname.ora文件中未设置load_balance=yes时，Oracle Net会根据地址列表依次链接，直至连接成功为止。

    - 在tnsname.ora文件中已经设置load_balance=yes时，Oracle Net会在地址列表中随机选择地址，直至链接成功为止。

  - 服务端的负载均衡： 

    - 服务端在均衡指，考虑RAC各节点的连接情况将最小负荷的节点与其客户端进行连接。 
    - 开库状态下，PMON进程每三秒将本节点的负荷连接数更新到server_register中。  
    - 节点监听器故障PMON每秒探查一次故障监听器是否重启。

​	<span style='color:blue'>【高可用经验】：高可用主要指7*24小时 nonstop不停机工作。银行要求的高可用性要求级别为99.9999%，小数点后四个9。两个节点（双node）一般能达到小数点后的两个9。</span>  

#### 二、Scability 扩展性   

​		扩展性主要体现提供数据库业务的吞吐量，集群整体的吞吐量又受到，节点CPU处理速率、交换机处理速率、磁盘阵列控制器处理速率三方面的限制。    

吞吐量主要在以下三个方面改善：   

- 可以运行多个批处理,即，在不同节点同时运行批处理操作；   
- 可以处理更多的并行执行操作提高并行度数，增加每个节点的并行度，从而达到整体并行度的提升；   
- 可以借助RAC大幅度增加联机事务处理OLAP，因为RAC提供联机并行查询操作；



### RAC集群要求  

1. 各个节点版本一致（如：版本类型和版本号都要一致）。
2. 集群内各个节点不能离得太远，因为集群使用<font color="red">内网线</font>对速率要求很高。  
3. 集群软件隐藏内部结构（Oracle中的CRS），通过DML锁机制实现，以协调内部工作。


##### 注：使用集群对同一个事务起不到优化作用。
​	select可加快：因为集群提供分布式查询，所以查询可以加快
​	insert、update、delete在集群中不可加快  

​	<span style='color:blue'>【经验】：工作中2节点的占大部分、4节点的很少、8节点的少之又少，因为节点上来之后，协调各个节点之间的管理代价也会增高。</span>



### RAC中的单活双活应用场景

- 单活的应用场景：一般都是业务单一类型，一台机器down时，另一台承担down掉那台机器的工作量，down掉的机器拿去维修。 
- 双活的应用场景：一般是两个应用，一台机器上面跑一个应用，对应用进行应用切割，不同应用之间通过cache fusion协调信息。    



### RAC中VIP

因为RAC对内网速率要求极高，如果使用TCP/IP协议机制需要经历四次握手，在握手期间时间过长，所以采用VIP机制可以更快在不同节点之间沟通信息，判断对方节点是否存，也成活心跳机制。

- VIP的本质：代替OS层面的TCP/IP超时阈值机制  
- VIP的现象：是实现了VIP的调优



### 脑裂与健忘症

脑裂、健忘症均是RAC中的现象

- 注册表--健忘症
- 选举--脑裂   当心跳不通时，需要vote决定是哪个是属于集群的节点
  - 奇数节点选票少的partition的node重启看是否能够重新连接；
  - 偶数节点中，最初采用两节点中率先争到共享磁盘连接的便使用，另一部分被独立。现在使用注册表中编号较小的节点作为可使用集群的节点。



### ORC镜像盘数量

OCR：normal模式有3个镜像盘，high模式有5个镜像盘





















